import{createRequire as e}from"module";var t={676:(e,t,r)=>{const{Transform:s}=r(203);const[n]=Buffer.from("\r");const[i]=Buffer.from("\n");const o={escape:'"',headers:null,mapHeaders:({header:e})=>e,mapValues:({value:e})=>e,newline:"\n",quote:'"',raw:false,separator:",",skipComments:false,skipLines:null,maxRowBytes:Number.MAX_SAFE_INTEGER,strict:false,outputByteOffset:false};class CsvParser extends s{constructor(e={}){super({objectMode:true,highWaterMark:16});if(Array.isArray(e))e={headers:e};const t=Object.assign({},o,e);t.customNewline=t.newline!==o.newline;for(const e of["newline","quote","separator"]){if(typeof t[e]!=="undefined"){[t[e]]=Buffer.from(t[e])}}t.escape=(e||{}).escape?Buffer.from(t.escape)[0]:t.quote;this.state={empty:t.raw?Buffer.alloc(0):"",escaped:false,first:true,lineNumber:0,previousEnd:0,rowLength:0,quoted:false};this._prev=null;if(t.headers===false){t.strict=false}if(t.headers||t.headers===false){this.state.first=false}this.options=t;this.headers=t.headers;this.bytesRead=0}parseCell(e,t,r){const{escape:s,quote:n}=this.options;if(e[t]===n&&e[r-1]===n){t++;r--}let i=t;for(let o=t;o<r;o++){if(e[o]===s&&o+1<r&&e[o+1]===n){o++}if(i!==o){e[i]=e[o]}i++}return this.parseValue(e,t,i)}parseLine(e,t,r){const{customNewline:s,escape:i,mapHeaders:o,mapValues:a,quote:u,separator:l,skipComments:c,skipLines:f}=this.options;r--;if(!s&&e.length&&e[r-1]===n){r--}const d=l;const p=[];let h=false;let v=t;if(c){const r=typeof c==="string"?c:"#";if(e[t]===Buffer.from(r)[0]){return}}const mapValue=e=>{if(this.state.first){return e}const t=p.length;const r=this.headers[t];return a({header:r,index:t,value:e})};for(let s=t;s<r;s++){const t=!h&&e[s]===u;const n=h&&e[s]===u&&s+1<=r&&e[s+1]===d;const o=h&&e[s]===i&&s+1<r&&e[s+1]===u;if(t||n){h=!h;continue}else if(o){s++;continue}if(e[s]===d&&!h){let t=this.parseCell(e,v,s);t=mapValue(t);p.push(t);v=s+1}}if(v<r){let t=this.parseCell(e,v,r);t=mapValue(t);p.push(t)}if(e[r-1]===d){p.push(mapValue(this.state.empty))}const m=f&&f>this.state.lineNumber;this.state.lineNumber++;if(this.state.first&&!m){this.state.first=false;this.headers=p.map(((e,t)=>o({header:e,index:t})));this.emit("headers",this.headers);return}if(!m&&this.options.strict&&p.length!==this.headers.length){const e=new RangeError("Row length does not match headers");this.emit("error",e)}else{if(!m){const r=this.bytesRead-e.length+t;this.writeRow(p,r)}}}parseValue(e,t,r){if(this.options.raw){return e.slice(t,r)}return e.toString("utf-8",t,r)}writeRow(e,t){const r=this.headers===false?e.map(((e,t)=>t)):this.headers;const s=e.reduce(((e,t,s)=>{const n=r[s];if(n===null)return e;if(n!==undefined){e[n]=t}else{e[`_${s}`]=t}return e}),{});if(this.options.outputByteOffset){this.push({row:s,byteOffset:t})}else{this.push(s)}}_flush(e){if(this.state.escaped||!this._prev)return e();this.parseLine(this._prev,this.state.previousEnd,this._prev.length+1);e()}_transform(e,t,r){if(typeof e==="string"){e=Buffer.from(e)}const{escape:s,quote:o}=this.options;let a=0;let u=e;this.bytesRead+=e.byteLength;if(this._prev){a=this._prev.length;u=Buffer.concat([this._prev,e]);this._prev=null}const l=u.length;for(let e=a;e<l;e++){const t=u[e];const c=e+1<l?u[e+1]:null;this.state.rowLength++;if(this.state.rowLength>this.options.maxRowBytes){return r(new Error("Row exceeds the maximum size"))}if(!this.state.escaped&&t===s&&c===o&&e!==a){this.state.escaped=true;continue}else if(t===o){if(this.state.escaped){this.state.escaped=false}else{this.state.quoted=!this.state.quoted}continue}if(!this.state.quoted){if(this.state.first&&!this.options.customNewline){if(t===i){this.options.newline=i}else if(t===n){if(c!==i){this.options.newline=n}}}if(t===this.options.newline){this.parseLine(u,this.state.previousEnd,e+1);this.state.previousEnd=e+1;this.state.rowLength=0}}}if(this.state.previousEnd===l){this.state.previousEnd=0;return r()}if(l-this.state.previousEnd<e.length){this._prev=e;this.state.previousEnd-=l-e.length;return r()}this._prev=u;r()}}e.exports=e=>new CsvParser(e)},53:(e,t,r)=>{var s=r(611);const n=r(982);class iKuai{constructor(e,t,n){this.host=e;this.port=t;if(n){s=r(692)}}login(e,t,r){let i=n.createHash("md5").update(t).digest("hex");let o=new Buffer.from("salt_11"+t).toString("base64");let a={passwd:i,pass:o,remember_password:"",username:e};let u={method:"POST",host:this.host,port:this.port,path:"/Action/login"};var l=this;if(r){let e=s.request(u,(function(e,t){e.setEncoding("utf-8");e.on("data",(function(t){let s=JSON.parse(t);if(s&&s.Result==1e4){l.accessKey=e.headers["set-cookie"][0];r(e.headers["set-cookie"][0])}else{r(s)}}))}));e.write(JSON.stringify(a));e.end()}else return new Promise(((e,t)=>{let r=s.request(u,(function(r,s){r.setEncoding("utf-8");r.on("data",(function(s){let n=JSON.parse(s);if(n&&n.Result==1e4){l.accessKey=r.headers["set-cookie"][0];e(r.headers["set-cookie"][0])}else{t(n)}}))}));r.write(JSON.stringify(a));r.end()}))}exec(e,t,r,n,i){if(typeof n=="function")i=n;if(i){let u;if(this.accessKey){u=this.accessKey}else{u=n}if(u){var o={method:"POST",host:this.host,port:this.port,path:"/Action/call",headers:{Cookie:u}};var a=s.request(o,(function(e,t){e.setEncoding("utf-8");let r="";e.on("data",(function(e){r+=e}));e.on("end",(()=>{try{r=JSON.parse(r)}catch(e){console.log(e)}finally{i(r)}}))}));a.write(JSON.stringify({func_name:e,action:t,param:r}));a.end()}else{i("ERR_NOT_LOGGED_IN")}}else return new Promise(((i,o)=>{let a;if(this.accessKey){a=this.accessKey}else{a=n}if(a){var u={method:"POST",host:this.host,port:this.port,path:"/Action/call",headers:{Cookie:a}};var l=s.request(u,(function(e,t){e.setEncoding("utf-8");let r="";e.on("data",(function(e){r+=e}));e.on("end",(()=>{try{r=JSON.parse(r)}catch(e){console.log(e)}finally{i(r)}}))}));l.write(JSON.stringify({func_name:e,action:t,param:r}));l.end()}else{o("ERR_NOT_LOGGED_IN")}}))}}e.exports=iKuai},297:(e,t,r)=>{const s=r(434);const n=r(928);const{fork:i}=r(317);const o=r(48);const a=r.ab+"daemon.js";class BackgroundScheduledTask extends s{constructor(e,t,r){super();if(!r){r={scheduled:true,recoverMissedExecutions:false}}this.cronExpression=e;this.taskPath=t;this.options=r;this.options.name=this.options.name||o.v4();if(r.scheduled){this.start()}}start(){this.stop();this.forkProcess=i(r.ab+"daemon.js");this.forkProcess.on("message",(e=>{switch(e.type){case"task-done":this.emit("task-done",e.result);break}}));let e=this.options;e.scheduled=true;this.forkProcess.send({type:"register",path:n.resolve(this.taskPath),cron:this.cronExpression,options:e})}stop(){if(this.forkProcess){this.forkProcess.kill()}}pid(){if(this.forkProcess){return this.forkProcess.pid}}isRunning(){return!this.forkProcess.killed}}e.exports=BackgroundScheduledTask},62:e=>{e.exports=(()=>{function convertAsterisk(e,t){if(e.indexOf("*")!==-1){return e.replace("*",t)}return e}function convertAsterisksToRanges(e){e[0]=convertAsterisk(e[0],"0-59");e[1]=convertAsterisk(e[1],"0-59");e[2]=convertAsterisk(e[2],"0-23");e[3]=convertAsterisk(e[3],"1-31");e[4]=convertAsterisk(e[4],"1-12");e[5]=convertAsterisk(e[5],"0-6");return e}return convertAsterisksToRanges})()},7:(e,t,r)=>{const s=r(361);const n=r(922);const i=r(62);const o=r(963);const a=r(137);e.exports=(()=>{function appendSeccondExpression(e){if(e.length===5){return["0"].concat(e)}return e}function removeSpaces(e){return e.replace(/\s{2,}/g," ").trim()}function normalizeIntegers(e){for(let t=0;t<e.length;t++){const r=e[t].split(",");for(let e=0;e<r.length;e++){r[e]=parseInt(r[e])}e[t]=r}return e}function interprete(e){let t=removeSpaces(e).split(" ");t=appendSeccondExpression(t);t[4]=s(t[4]);t[5]=n(t[5]);t=i(t);t=o(t);t=a(t);t=normalizeIntegers(t);return t.join(" ")}return interprete})()},361:e=>{e.exports=(()=>{const e=["january","february","march","april","may","june","july","august","september","october","november","december"];const t=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];function convertMonthName(e,t){for(let r=0;r<t.length;r++){e=e.replace(new RegExp(t[r],"gi"),parseInt(r,10)+1)}return e}function interprete(r){r=convertMonthName(r,e);r=convertMonthName(r,t);return r}return interprete})()},963:e=>{e.exports=(()=>{function replaceWithRange(e,t,r,s){const n=[];let i=parseInt(s);let o=parseInt(r);if(o>i){i=parseInt(r);o=parseInt(s)}for(let e=o;e<=i;e++){n.push(e)}return e.replace(new RegExp(t,"i"),n.join())}function convertRange(e){const t=/(\d+)-(\d+)/;let r=t.exec(e);while(r!==null&&r.length>0){e=replaceWithRange(e,r[0],r[1],r[2]);r=t.exec(e)}return e}function convertAllRanges(e){for(let t=0;t<e.length;t++){e[t]=convertRange(e[t])}return e}return convertAllRanges})()},137:e=>{e.exports=(()=>{function convertSteps(e){var t=/^(.+)\/(\w+)$/;for(var r=0;r<e.length;r++){var s=t.exec(e[r]);var n=s!==null&&s.length>0;if(n){var i=s[2];if(isNaN(i)){throw i+" is not a valid step value"}var o=s[1].split(",");var a=[];var u=parseInt(i,10);for(var l=0;l<=o.length;l++){var c=parseInt(o[l],10);if(c%u===0){a.push(c)}}e[r]=a.join(",")}}return e}return convertSteps})()},922:e=>{e.exports=(()=>{const e=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];const t=["sun","mon","tue","wed","thu","fri","sat"];function convertWeekDayName(e,t){for(let r=0;r<t.length;r++){e=e.replace(new RegExp(t[r],"gi"),parseInt(r,10))}return e}function convertWeekDays(r){r=r.replace("7","0");r=convertWeekDayName(r,e);return convertWeekDayName(r,t)}return convertWeekDays})()},421:(e,t,r)=>{const s=r(319);const n=r(297);const i=r(382);const o=r(59);function schedule(e,t,r){const s=createTask(e,t,r);o.save(s);return s}function createTask(e,t,r){if(typeof t==="string")return new n(e,t,r);return new s(e,t,r)}function validate(e){try{i(e);return true}catch(e){return false}}function getTasks(){return o.getTasks()}e.exports={schedule:schedule,validate:validate,getTasks:getTasks}},382:(e,t,r)=>{const s=r(7);const n=/^(?:\d+|\*|\*\/\d+)$/;function isValidExpression(e,t,r){const s=e.split(",");for(const e of s){const s=parseInt(e,10);if(!Number.isNaN(s)&&(s<t||s>r)||!n.test(e))return false}return true}function isInvalidSecond(e){return!isValidExpression(e,0,59)}function isInvalidMinute(e){return!isValidExpression(e,0,59)}function isInvalidHour(e){return!isValidExpression(e,0,23)}function isInvalidDayOfMonth(e){return!isValidExpression(e,1,31)}function isInvalidMonth(e){return!isValidExpression(e,1,12)}function isInvalidWeekDay(e){return!isValidExpression(e,0,7)}function validateFields(e,t){if(isInvalidSecond(t[0]))throw new Error(`${e[0]} is a invalid expression for second`);if(isInvalidMinute(t[1]))throw new Error(`${e[1]} is a invalid expression for minute`);if(isInvalidHour(t[2]))throw new Error(`${e[2]} is a invalid expression for hour`);if(isInvalidDayOfMonth(t[3]))throw new Error(`${e[3]} is a invalid expression for day of month`);if(isInvalidMonth(t[4]))throw new Error(`${e[4]} is a invalid expression for month`);if(isInvalidWeekDay(t[5]))throw new Error(`${e[5]} is a invalid expression for week day`)}function validate(e){if(typeof e!=="string")throw new TypeError("pattern must be a string!");const t=e.split(" ");const r=s(e).split(" ");if(t.length===5)t.unshift("0");validateFields(t,r)}e.exports=validate},319:(e,t,r)=>{const s=r(434);const n=r(601);const i=r(115);const o=r(48);class ScheduledTask extends s{constructor(e,t,r){super();if(!r){r={scheduled:true,recoverMissedExecutions:false}}this.options=r;this.options.name=this.options.name||o.v4();this._task=new n(t);this._scheduler=new i(e,r.timezone,r.recoverMissedExecutions);this._scheduler.on("scheduled-time-matched",(e=>{this.now(e)}));if(r.scheduled!==false){this._scheduler.start()}if(r.runOnInit===true){this.now("init")}}now(e="manual"){let t=this._task.execute(e);this.emit("task-done",t)}start(){this._scheduler.start()}stop(){this._scheduler.stop()}}e.exports=ScheduledTask},115:(e,t,r)=>{const s=r(434);const n=r(486);class Scheduler extends s{constructor(e,t,r){super();this.timeMatcher=new n(e,t);this.autorecover=r}start(){this.stop();let e=process.hrtime();let t=this.timeMatcher.apply(new Date);const matchTime=()=>{const r=1e3;const s=process.hrtime(e);const n=(s[0]*1e9+s[1])/1e6;const i=Math.floor(n/1e3);for(let e=i;e>=0;e--){const r=new Date((new Date).getTime()-e*1e3);let s=this.timeMatcher.apply(r);if(t.getTime()<s.getTime()&&(e===0||this.autorecover)&&this.timeMatcher.match(r)){this.emit("scheduled-time-matched",s);s.setMilliseconds(0);t=s}}e=process.hrtime();this.timeout=setTimeout(matchTime,r)};matchTime()}stop(){if(this.timeout){clearTimeout(this.timeout)}this.timeout=null}}e.exports=Scheduler},59:(e,t,r)=>{e.exports=(()=>{if(!global.scheduledTasks){global.scheduledTasks=new Map}return{save:e=>{if(!e.options){const t=r(48);e.options={};e.options.name=t.v4()}global.scheduledTasks.set(e.options.name,e)},getTasks:()=>global.scheduledTasks}})()},601:(e,t,r)=>{const s=r(434);class Task extends s{constructor(e){super();if(typeof e!=="function"){throw"execution must be a function"}this._execution=e}execute(e){let t;try{t=this._execution(e)}catch(e){return this.emit("task-failed",e)}if(t instanceof Promise){return t.then((()=>this.emit("task-finished"))).catch((e=>this.emit("task-failed",e)))}else{this.emit("task-finished");return t}}}e.exports=Task},486:(e,t,r)=>{const s=r(382);const n=r(7);function matchPattern(e,t){if(e.indexOf(",")!==-1){const r=e.split(",");return r.indexOf(t.toString())!==-1}return e===t.toString()}class TimeMatcher{constructor(e,t){s(e);this.pattern=n(e);this.timezone=t;this.expressions=this.pattern.split(" ");this.dtf=this.timezone?new Intl.DateTimeFormat("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hourCycle:"h23",fractionalSecondDigits:3,timeZone:this.timezone}):null}match(e){e=this.apply(e);const t=matchPattern(this.expressions[0],e.getSeconds());const r=matchPattern(this.expressions[1],e.getMinutes());const s=matchPattern(this.expressions[2],e.getHours());const n=matchPattern(this.expressions[3],e.getDate());const i=matchPattern(this.expressions[4],e.getMonth()+1);const o=matchPattern(this.expressions[5],e.getDay());return t&&r&&s&&n&&i&&o}apply(e){if(this.dtf){return new Date(this.dtf.format(e))}return e}}e.exports=TimeMatcher},48:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});Object.defineProperty(t,"v1",{enumerable:true,get:function(){return s.default}});Object.defineProperty(t,"v3",{enumerable:true,get:function(){return n.default}});Object.defineProperty(t,"v4",{enumerable:true,get:function(){return i.default}});Object.defineProperty(t,"v5",{enumerable:true,get:function(){return o.default}});Object.defineProperty(t,"NIL",{enumerable:true,get:function(){return a.default}});Object.defineProperty(t,"version",{enumerable:true,get:function(){return u.default}});Object.defineProperty(t,"validate",{enumerable:true,get:function(){return l.default}});Object.defineProperty(t,"stringify",{enumerable:true,get:function(){return c.default}});Object.defineProperty(t,"parse",{enumerable:true,get:function(){return f.default}});var s=_interopRequireDefault(r(415));var n=_interopRequireDefault(r(697));var i=_interopRequireDefault(r(295));var o=_interopRequireDefault(r(771));var a=_interopRequireDefault(r(723));var u=_interopRequireDefault(r(868));var l=_interopRequireDefault(r(200));var c=_interopRequireDefault(r(597));var f=_interopRequireDefault(r(267));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}},216:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t["default"]=void 0;var s=_interopRequireDefault(r(982));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function md5(e){if(Array.isArray(e)){e=Buffer.from(e)}else if(typeof e==="string"){e=Buffer.from(e,"utf8")}return s.default.createHash("md5").update(e).digest()}var n=md5;t["default"]=n},723:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t["default"]=void 0;var r="00000000-0000-0000-0000-000000000000";t["default"]=r},267:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t["default"]=void 0;var s=_interopRequireDefault(r(200));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function parse(e){if(!(0,s.default)(e)){throw TypeError("Invalid UUID")}let t;const r=new Uint8Array(16);r[0]=(t=parseInt(e.slice(0,8),16))>>>24;r[1]=t>>>16&255;r[2]=t>>>8&255;r[3]=t&255;r[4]=(t=parseInt(e.slice(9,13),16))>>>8;r[5]=t&255;r[6]=(t=parseInt(e.slice(14,18),16))>>>8;r[7]=t&255;r[8]=(t=parseInt(e.slice(19,23),16))>>>8;r[9]=t&255;r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255;r[11]=t/4294967296&255;r[12]=t>>>24&255;r[13]=t>>>16&255;r[14]=t>>>8&255;r[15]=t&255;return r}var n=parse;t["default"]=n},879:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t["default"]=void 0;var r=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;t["default"]=r},973:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t["default"]=rng;var s=_interopRequireDefault(r(982));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const n=new Uint8Array(256);let i=n.length;function rng(){if(i>n.length-16){s.default.randomFillSync(n);i=0}return n.slice(i,i+=16)}},507:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t["default"]=void 0;var s=_interopRequireDefault(r(982));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function sha1(e){if(Array.isArray(e)){e=Buffer.from(e)}else if(typeof e==="string"){e=Buffer.from(e,"utf8")}return s.default.createHash("sha1").update(e).digest()}var n=sha1;t["default"]=n},597:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t["default"]=void 0;var s=_interopRequireDefault(r(200));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const n=[];for(let e=0;e<256;++e){n.push((e+256).toString(16).substr(1))}function stringify(e,t=0){const r=(n[e[t+0]]+n[e[t+1]]+n[e[t+2]]+n[e[t+3]]+"-"+n[e[t+4]]+n[e[t+5]]+"-"+n[e[t+6]]+n[e[t+7]]+"-"+n[e[t+8]]+n[e[t+9]]+"-"+n[e[t+10]]+n[e[t+11]]+n[e[t+12]]+n[e[t+13]]+n[e[t+14]]+n[e[t+15]]).toLowerCase();if(!(0,s.default)(r)){throw TypeError("Stringified UUID is invalid")}return r}var i=stringify;t["default"]=i},415:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t["default"]=void 0;var s=_interopRequireDefault(r(973));var n=_interopRequireDefault(r(597));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}let i;let o;let a=0;let u=0;function v1(e,t,r){let l=t&&r||0;const c=t||new Array(16);e=e||{};let f=e.node||i;let d=e.clockseq!==undefined?e.clockseq:o;if(f==null||d==null){const t=e.random||(e.rng||s.default)();if(f==null){f=i=[t[0]|1,t[1],t[2],t[3],t[4],t[5]]}if(d==null){d=o=(t[6]<<8|t[7])&16383}}let p=e.msecs!==undefined?e.msecs:Date.now();let h=e.nsecs!==undefined?e.nsecs:u+1;const v=p-a+(h-u)/1e4;if(v<0&&e.clockseq===undefined){d=d+1&16383}if((v<0||p>a)&&e.nsecs===undefined){h=0}if(h>=1e4){throw new Error("uuid.v1(): Can't create more than 10M uuids/sec")}a=p;u=h;o=d;p+=122192928e5;const m=((p&268435455)*1e4+h)%4294967296;c[l++]=m>>>24&255;c[l++]=m>>>16&255;c[l++]=m>>>8&255;c[l++]=m&255;const _=p/4294967296*1e4&268435455;c[l++]=_>>>8&255;c[l++]=_&255;c[l++]=_>>>24&15|16;c[l++]=_>>>16&255;c[l++]=d>>>8|128;c[l++]=d&255;for(let e=0;e<6;++e){c[l+e]=f[e]}return t||(0,n.default)(c)}var l=v1;t["default"]=l},697:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t["default"]=void 0;var s=_interopRequireDefault(r(930));var n=_interopRequireDefault(r(216));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const i=(0,s.default)("v3",48,n.default);var o=i;t["default"]=o},930:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t["default"]=_default;t.URL=t.DNS=void 0;var s=_interopRequireDefault(r(597));var n=_interopRequireDefault(r(267));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function stringToBytes(e){e=unescape(encodeURIComponent(e));const t=[];for(let r=0;r<e.length;++r){t.push(e.charCodeAt(r))}return t}const i="6ba7b810-9dad-11d1-80b4-00c04fd430c8";t.DNS=i;const o="6ba7b811-9dad-11d1-80b4-00c04fd430c8";t.URL=o;function _default(e,t,r){function generateUUID(e,i,o,a){if(typeof e==="string"){e=stringToBytes(e)}if(typeof i==="string"){i=(0,n.default)(i)}if(i.length!==16){throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)")}let u=new Uint8Array(16+e.length);u.set(i);u.set(e,i.length);u=r(u);u[6]=u[6]&15|t;u[8]=u[8]&63|128;if(o){a=a||0;for(let e=0;e<16;++e){o[a+e]=u[e]}return o}return(0,s.default)(u)}try{generateUUID.name=e}catch(e){}generateUUID.DNS=i;generateUUID.URL=o;return generateUUID}},295:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t["default"]=void 0;var s=_interopRequireDefault(r(973));var n=_interopRequireDefault(r(597));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function v4(e,t,r){e=e||{};const i=e.random||(e.rng||s.default)();i[6]=i[6]&15|64;i[8]=i[8]&63|128;if(t){r=r||0;for(let e=0;e<16;++e){t[r+e]=i[e]}return t}return(0,n.default)(i)}var i=v4;t["default"]=i},771:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t["default"]=void 0;var s=_interopRequireDefault(r(930));var n=_interopRequireDefault(r(507));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const i=(0,s.default)("v5",80,n.default);var o=i;t["default"]=o},200:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t["default"]=void 0;var s=_interopRequireDefault(r(879));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function validate(e){return typeof e==="string"&&s.default.test(e)}var n=validate;t["default"]=n},868:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t["default"]=void 0;var s=_interopRequireDefault(r(200));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function version(e){if(!(0,s.default)(e)){throw TypeError("Invalid UUID")}return parseInt(e.substr(14,1),16)}var n=version;t["default"]=n},317:t=>{t.exports=e(import.meta.url)("child_process")},982:t=>{t.exports=e(import.meta.url)("crypto")},434:t=>{t.exports=e(import.meta.url)("events")},611:t=>{t.exports=e(import.meta.url)("http")},692:t=>{t.exports=e(import.meta.url)("https")},928:t=>{t.exports=e(import.meta.url)("path")},203:t=>{t.exports=e(import.meta.url)("stream")}};var r={};function __nccwpck_require__(e){var s=r[e];if(s!==undefined){return s.exports}var n=r[e]={exports:{}};var i=true;try{t[e](n,n.exports,__nccwpck_require__);i=false}finally{if(i)delete r[e]}return n.exports}if(typeof __nccwpck_require__!=="undefined")__nccwpck_require__.ab=new URL(".",import.meta.url).pathname.slice(import.meta.url.match(/^file:\/\/\/\w:/)?1:0,-1)+"/";var s={};var n=__nccwpck_require__(317);var i=__nccwpck_require__(928);const o=e(import.meta.url)("url");var a=__nccwpck_require__(676);const u=e(import.meta.url)("fs");var l=__nccwpck_require__(53);var c=__nccwpck_require__(421);const f=process.env.ENABLE_V6||false;const d=process.env.CRON||"0 0 0 * * *";const p=process.env.DOMAIN_SET!=null?process.env.DOMAIN_SET.split(","):[];const h=process.env.ROUTER_USERNAME;const v=process.env.ROUTER_PASSWORD;const m=process.env.ROUTER_IP;const _=process.env.ROUTER_PORT||80;const g=process.env.DOWNLOAD_NUM;const y=process.env.TIME_LIMIT;const w=process.env.TIME_LOWER_LIMIT;const R=process.env.LOSS_RATE;const x=process.env.SPEED_LIMIT;const k=process.env.SELECT_NUM||6;function log(e){const t=(new Date).toISOString();console.log(`[${t}] ${e}`)}function getIp(e,t){return new Promise(((r,s)=>{const n=[];let i=0;u.createReadStream(e+"/"+t).pipe(a()).on("data",(e=>{if(i<k){log("item:"+JSON.stringify(e));i++;n.push(e["IP 地址"])}})).on("end",(()=>r(n))).on("error",s)}))}async function speedtest(e,t,r){log("param:"+r+",workdir:"+t+",scrpitName:"+e);return new Promise(((s,i)=>{const o=(0,n.spawn)("./"+e,r,{cwd:t,stdio:"ignore"});o.on("close",(async e=>{log(`CloudflareST 退出，退出码：${e}`);log("测速完成,保留数量");s()}))}))}async function update2ikuai(e,t){if(p==null||p.length==0||m==null||v==null||h==null)return;if(!["ipv4","ipv6"].includes(t))return;log("ROUTER_IP:"+m);log("DOMAIN_SET:"+p);log("ROUTER_PORT:"+_);log("ROUTER_USERNAME:"+h);log("ROUTER_PASSWORD:"+v);const r=new l(m,_);try{const e=await r.login(h,v);log("token:"+e)}catch(e){log("登陆失败请检查，IP，端口，用户名与密码是否正确")}for(let s=0;s<p.length;s++){let{Data:{data:n}}=await r.exec("dns","show",{TYPE:"dns_proxy_total,dns_proxy",FINDS:"domain,dns_addr,src_addr,comment",FILTER1:"domain,=,"+p[s],FILTER2:"parse_type,=,"+t,limit:"0,100"});log(JSON.stringify(n));if(n!=null&&n.length>0){for(let t=0;t<n.length;t++){let s=JSON.parse(JSON.stringify(n[t]));s["dns_addr"]=e.join(",");let{ErrMsg:i}=await r.exec("dns","edit",s);log("修改："+i)}}else{log("不存在。新建");let n=JSON.parse(JSON.stringify({dns_addr:e.join(","),domain:p[s],enabled:"yes",parse_type:t}));try{log("添加："+JSON.stringify(n));await r.exec("dns","add",n)}catch(e){}}}}async function task(e,t){const r="result.csv";const s="result6.csv";const n=[];if(g!=null&&!isNaN(Number(g))&&g>0){n.push("-dn",g)}if(y!=null&&!isNaN(Number(y))&&y>0){n.push("-tl",y)}if(w!=null&&!isNaN(Number(w))&&w>0){n.push("-tll",w)}if(R!=null&&!isNaN(Number(R))&&R>0){n.push("-tlr",R)}if(x!=null&&!isNaN(Number(x))&&x>0){n.push("-sl",x)}log("V4测速......");await speedtest(t,e,["-o",r,...n]);let i=await getIp(e,r);log("V4----\x3e:"+i);await update2ikuai(i,"ipv4");if(f){log("V6测速......");await speedtest(t,e,["-o",s,"-f","ipv6.txt",...n]);let r=await getIp(e,s);log("V6----\x3e:"+r);update2ikuai(r,"ipv6")}log("测速结束");log("程序结束")}async function main(){let e="";if(process.platform==="win32"){log("Running on Windows");e="CloudflareST.exe"}else if(process.platform==="linux"){log("Running on Linux");e="CloudflareST"}if(e==null||e==""){log("系统不支持，请使用win32或者linux");return}const t=(0,o.fileURLToPath)(import.meta.url);const r=i.dirname(t);const s=i.join(r,"assets");await task(s,e);c.schedule(d,(()=>{log("开始定时任务，更新CF优选----");task(s,e)})).start()}main();